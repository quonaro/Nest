build(target: str = "x86_64", release: bool = false):
    > desc: Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Cargo
    > cwd: ./app
    > env: .env
    > env: BUILD_TIME={{now}}
    > script: |
        #!/bin/sh
        echo "ðŸ”¨ Building $target (release=${release})"
        cargo build --target "$target" ${release:+--release}

dev:
    > desc: Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

    default(hot: bool = false):
        > desc: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ dev-ÑÐµÑ€Ð²ÐµÑ€
        > env: .env.local
        > env: NODE_ENV=development
        > script: |
            #!/bin/sh
            if [ "$hot" = "true" ]; then
                nodemon src/index.js
            else
                node src/index.js
            fi

    lint(fix|f: bool = false):
        > desc: ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´
        > script: |
            #!/bin/sh
            eslint src/ ${fix:+--fix}

db:
    > desc: Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð°Ð·Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

    default():
        > desc: Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ° Ð¿Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼ Ð‘Ð”
        > script: |
            #!/bin/sh
            echo "Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:"
            echo "  nest db up     â€” Ð½Ð°ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸"
            echo "  nest db down   â€” Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸"

    up():
        > desc: ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
        > env: DATABASE_URL=postgresql://localhost/dev
        > script: ./scripts/migrate_up.sh

    down(force|f: bool = false):
        > desc: ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
        > script: |
            #!/bin/sh
            if [ "$force" = "true" ]; then
                ./migrate down --force
            else
                ./migrate down
            fi

deploy:
    > desc: Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ

    prod(
        version: str,
        confirm|c: bool = false,
        retries: num = 3,
        tags: arr = []
    ):
        > desc: Ð—Ð°Ð´ÐµÐ¿Ð»Ð¾Ð¸Ñ‚ÑŒ Ð² production
        > env: .env.prod
        > env: DEPLOYER={{user}}
        > script: |
            #!/bin/sh
            if [ "$confirm" != "true" ]; then
                echo "ðŸ›‘ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ --confirm Ð¸Ð»Ð¸ -c"
                exit 1
            fi
            cmd="./deploy.sh $version --retries $retries"
            for tag in $(echo "$tags" | tr ',' ' '); do
                cmd="$cmd --tag $tag"
            done
            eval "$cmd"

    staging(version: str):
        > desc: Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð² staging-ÑÑ€ÐµÐ´Ñƒ
        > env: .env.staging
        > script: |
            #!/bin/sh
            ./deploy.sh "$version" --env staging